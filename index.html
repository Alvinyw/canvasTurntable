<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<title>转盘抽奖</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<style>
* { padding: 0px; margin: 0px; font-size: 16px; font-family: "Microsoft YaHei"; }
</style>
<script type="text/javascript" src="js/jquery.min.js"></script>
</head>
<body>
<div style="width:300px; height:300px; position:relative;">
    <canvas id="myCanvas" width="300px" height="300px" style="position:absolute; background-color: white; border-radius: 100%; -o-transform: transform 1s; -ms-transform: transform 1s; -moz-transform: transform 1s; -webkit-transform: transform 1s; transition: transform 1s; -o-transform-origin: 50% 50%; -ms-transform-origin: 50% 50%; -moz-transform-origin: 50% 50%; -webkit-transform-origin: 50% 50%; transform-origin: 50% 50%;">抱歉！浏览器不支持。</canvas>
    <canvas id="myCanvas01" width="300px" height="300px" style="position:absolute; left: 0; top: 0; z-index: 30;">抱歉！浏览器不支持。</canvas>
    <button id="tupBtn" style="position: absolute; left: 120px; top: 120px; width: 60px; height: 60px; border-radius: 100%;  cursor: pointer; border: none; background: transparent; outline: none; z-index: 40;"></button>
</div>
    <script type="text/javascript">
	//转盘刻画参考 http://www.17sucai.com/pins/14555.html
	$(document).ready(function(){
		//旋转角度
		var angles;
		
		//可抽奖次数
		var clickNum = 5;
		
		//旋转次数
		var rotNum = 0;
		
		//中奖公告
		var notice = null;
		
		//转盘用到的颜色: [扇形颜色一，扇形颜色二，扇形字体颜色，指针字体颜色，指针和边框颜色]
		var color = ["#e9536a","#fbd7a1","#000","#fff","#666"];
		
		//扇形的文本内容
		var sectorText = ["片区一","片区二","片区三","片区四","片区五","片区六","片区七","片区八"];
			
		//初始化绘制转盘
		function initTurntable(){
			var canvas = document.getElementById('myCanvas');
			var canvas01 = document.getElementById('myCanvas01');
			var ctx = canvas.getContext('2d');
			var ctx1 = canvas01.getContext('2d');
			
			//初始化扇形
			initSector();
			
			//初始化扇形文本
			initSectorText();
			
			//初始化指针
			initPoint();
		
			//初始化扇形转盘
			function initSector(){
				var startAngle = 0;//扇形的开始弧度
				var endAngle = 0;//扇形的终止弧度
								
				//画一个8等份扇形组成的圆形
				for (var i = 0; i< 8; i++){
					startAngle = Math.PI*2*(i/8-1/16);
					endAngle = startAngle+Math.PI*2*(1/8);
					ctx.save();
					ctx.beginPath(); 
					ctx.arc(150,150,150, startAngle, endAngle, false);
					ctx.lineWidth = 300;
					if (i%2 == 0) {
						ctx.strokeStyle =  color[0];
					}else{
						ctx.strokeStyle =  color[1];
					}
					ctx.stroke();
					ctx.restore();
				} 
				
				//中间白底圆圈：半径：30
				ctx.beginPath();
				ctx.arc(150,150,30,0,Math.PI*2,false);
				ctx.fillStyle = color[3];
				ctx.fill();
				ctx.closePath();
			}
	
			//初始化扇形转盘文字
			function initSectorText(){	 
				ctx.textAlign='start';
				ctx.textBaseline='middle';
				ctx.fillStyle = color[2];
				var step = 2*Math.PI/8;
				for ( var i = 0; i < 8; i++) {
					ctx.save();
					ctx.beginPath();
					ctx.translate(150,150);
					ctx.rotate(i*step);
					ctx.font = "Bold 16px Microsoft YaHei";
					ctx.fillStyle = color[2];					
					var arrText = sectorText[i].split('');
					for(var j=0;j<arrText.length;j++){
						ctx.fillText(arrText[j], -10,20*j-120,40);
					}
					ctx.closePath();
					ctx.restore();
				}
			}
	
			function initPoint(){ 
				//画转盘最外边边框
				ctx1.beginPath(); 
				ctx1.strokeStyle = color[4];
				ctx1.arc(150,150,148, 0, Math.PI*2, false);
				ctx1.lineWidth = 3;
				ctx1.stroke();
				ctx1.closePath();
				//箭头指针
				ctx1.beginPath();
				ctx1.moveTo(150,90);
				ctx1.lineTo(142,130);
				ctx1.lineTo(158,130);
				ctx1.lineTo(150,90);
				ctx1.fillStyle = color[4];
				ctx1.fill();
				ctx1.closePath();
				//中间小圆
				ctx1.beginPath();
				ctx1.arc(150,150,27,0,Math.PI*2,false);
				ctx1.fillStyle = color[4];
				ctx1.fill();
				ctx1.closePath();
				//小圆文字
				ctx1.font = "Bold 16px Microsoft YaHei"; 
				ctx1.textAlign='start';
				ctx1.textBaseline='middle';
				ctx1.fillStyle = color[3];
				ctx1.beginPath();
				ctx1.fillText('开始',134,149,40);
				ctx1.fill();
				ctx1.closePath();
			}
		}
		
		//初始化转盘
		initTurntable();
		
		$('#tupBtn').bind('click',function(){
			if (clickNum >= 1) {
				//可抽奖次数减一
				//clickNum = clickNum-1;
				//转盘旋转
				runCup();
				//转盘旋转过程“开始抽奖”按钮无法点击
				$('#tupBtn').attr("disabled", true);
				//旋转次数加一
				rotNum = rotNum + 1;
				//“开始抽奖”按钮无法点击恢复点击
				setTimeout(function(){
					//alert(notice);
					console.log(notice);
					$('#tupBtn').removeAttr("disabled", true);
				},1000);
			}
			else{
				alert("亲，抽奖次数已用光！");
			}
		});
	
		//转盘旋转
		function runCup(){
			probability();
			var degValue = 'rotate('+angles+'deg'+')';
			$('#myCanvas').css('-o-transform',degValue);           //Opera
			$('#myCanvas').css('-ms-transform',degValue);          //IE浏览器
			$('#myCanvas').css('-moz-transform',degValue);         //Firefox
			$('#myCanvas').css('-webkit-transform',degValue);      //Chrome和Safari
			$('#myCanvas').css('transform',degValue);
		}
	
		//各奖项对应的旋转角度及中奖公告内容
		function probability(){
			//获取随机数
			var num = parseInt(Math.random()*(7 - 0 + 0) + 0);
			//概率
			if ( num == 0 ) {
				angles = 2160 * rotNum + 1800;
				notice = sectorText[0];
			}
			//概率
			else if ( num == 1 ) {
				angles = 2160 * rotNum + 1845;
				notice = sectorText[7];
			}
			//概率
			else if ( num == 2 ) {
				angles = 2160 * rotNum + 1890;
				notice = sectorText[6];
			}
			//概率
			else if ( num == 3 ) {
				angles = 2160 * rotNum + 1935;
				notice = sectorText[5];
			}
			//概率
			else if ( num == 4 ) {
				angles = 2160 * rotNum + 1980;
				notice = sectorText[4];
			}
			//概率
			else if ( num == 5 ) {
				angles = 2160 * rotNum + 2025;
				notice = sectorText[3];
			}
			//概率
			else if ( num == 6 ) {
				angles = 2160 * rotNum + 2070;
				notice = sectorText[2];
			}
			//概率
			else if ( num == 7 ) {
				angles = 2160 * rotNum + 2115;
				notice = sectorText[1];
			}
		}
		
		//获取随机数
		function rnd(n, m){
			return Math.floor(Math.random()*(m-n+1)+n)
		}
	});
	</script>
</body>
</html>