<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<title>转盘抽奖</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<style>
* { padding: 0px; margin: 0px; font-size: 16px; font-family: "Microsoft YaHei"; }
</style>
<script type="text/javascript" src="js/jquery.min.js"></script>
</head>
<body>
<div style="width:600px; height:600px; position:relative;">
    <canvas id="myCanvas" width="600px" height="600px" style="position:absolute; background-color: white; border-radius: 100%; -o-transform: transform 1s; -ms-transform: transform 1s; -moz-transform: transform 1s; -webkit-transform: transform 1s; transition: transform 1s; -o-transform-origin: 50% 50%; -ms-transform-origin: 50% 50%; -moz-transform-origin: 50% 50%; -webkit-transform-origin: 50% 50%; transform-origin: 50% 50%;">抱歉！浏览器不支持。</canvas>
    <canvas id="myCanvas01" width="600px" height="600px" style="position:absolute; left: 0; top: 0; z-index: 30;">抱歉！浏览器不支持。</canvas>
    <button id="tupBtn" style="position: absolute; left: 50%; top: 50%; width: 60px; height: 60px; margin:-30px 0 0 -30px; border-radius: 100%;  cursor: pointer; border: none; background: transparent; outline: none; z-index: 40;"></button>
</div>
    <script type="text/javascript">
	//转盘刻画参考 http://www.17sucai.com/pins/14555.html
	$(document).ready(function(){
		//旋转角度
		var angles;
		
		//旋转次数
		var rotNum = 0;
		
		//当前选中的文本索引
		var curIndex = 0;
		
		//当前抽中内容
		var notice = null;
		
		//转盘用到的颜色: [扇形颜色一，扇形颜色二，扇形字体颜色，指针字体颜色，指针和边框颜色]
		var color = ["#e9536a","#fbd7a1","#000","#fff","#666"];
		
		//扇形的文本内容
		var sectorText = ["片区一","片区二","片区三","片区四","片区五","片区六","片区七","片区八","片区九","片区十","片区十一","片区十二","片区十三","片区十四","片区十五"];
		var textNum = sectorText.length;
		
		//已选中过的文本内容
		var selectedText = new Array();
		
		//转盘 Canvas 参数
		var canvasWidth = 600;//转盘为圆形，宽高相等
		
		//初始化转盘
		initTurntable();
		
		$('#tupBtn').bind('click',function(){
			if(selectedText.length<sectorText.length){
				//拿到随机数，计算旋转角度和当前选中文本
				for(var i=0;i>-1;i++){
					curIndex = rnd(0,sectorText.length-1);
					if(!ifRepeat(selectedText,sectorText[curIndex])){
						angles = 6*360*(rotNum+1) - curIndex*(360/textNum);
						notice = sectorText[curIndex];
						selectedText.push(sectorText[curIndex]);
						break;
					}
				}
				
				//转盘旋转
				runCup();
				
				//转盘旋转过程“开始抽奖”按钮无法点击
				$('#tupBtn').attr("disabled", true);
				
				//旋转次数加一
				rotNum = rotNum + 1;
				
				//“开始抽奖”按钮无法点击恢复点击
				setTimeout(function(){
					//alert(notice);
					console.log(notice);
					$('#tupBtn').removeAttr("disabled", true);
				},1000);
			}else{
				alert("转盘里的内容已全部被选中！");
			}
		});
				
		//初始化绘制转盘
		function initTurntable(){
			var canvas = document.getElementById('myCanvas');
			var canvas01 = document.getElementById('myCanvas01');
			var ctx = canvas.getContext('2d');
			var ctx1 = canvas01.getContext('2d');
			
			//初始化扇形
			initSector();
			
			//初始化扇形文本
			initSectorText();
			
			//初始化指针
			initPoint();
		
			//初始化扇形转盘
			function initSector(){
				var startAngle = 0;//扇形的开始弧度
				var endAngle = 0;//扇形的终止弧度
								
				//画一个 textNum 等份扇形组成的圆形
				for (var i = 0; i< textNum; i++){
					startAngle = i*Math.PI*2/textNum - Math.PI/2 + Math.PI*2/textNum/2; //保证初始化时指针正好对应在 扇形一 的中间
					endAngle = startAngle+Math.PI*2*(1/textNum);
					ctx.save();
					ctx.beginPath(); 
					ctx.arc(canvasWidth/2,canvasWidth/2,canvasWidth/2, startAngle, endAngle, false);
					ctx.lineWidth = canvasWidth;
					if (i%2 == 0) {
						ctx.strokeStyle =  color[0];
					}else{
						ctx.strokeStyle =  color[1];
					}
					ctx.stroke();
					ctx.restore();
				} 
				
				//中间白底圆圈：半径：canvasWidth/10
				ctx.beginPath();
				ctx.arc(canvasWidth/2,canvasWidth/2,canvasWidth/10,0,Math.PI*2,false);
				ctx.fillStyle = color[3];
				ctx.fill();
				ctx.closePath();
			}
	
			//初始化扇形转盘文字
			function initSectorText(){	 
				ctx.textAlign='start';
				ctx.textBaseline='middle';
				ctx.fillStyle = color[2];
				var step = 2*Math.PI/textNum;
				for ( var i = 0; i < textNum; i++) {
					ctx.save();
					ctx.beginPath();
					ctx.translate(canvasWidth/2,canvasWidth/2);
					ctx.rotate(i*step);
					ctx.font = "Bold 16px Microsoft YaHei";
					ctx.fillStyle = color[2];					
					var arrText = sectorText[i].split('');
					for(var j=0;j<arrText.length;j++){
						//-8 是为了让文字向左偏移半个字的宽度（大概是 8px）
						ctx.fillText(arrText[j], -8, 20*j-(canvasWidth/2-35), 20);
					}
					ctx.closePath();
					ctx.restore();
				}
			}
	
			function initPoint(){ 
				//画转盘最外边边框
				ctx1.beginPath(); 
				ctx1.strokeStyle = color[4];
				ctx1.arc(canvasWidth/2,canvasWidth/2,canvasWidth/2-2, 0, Math.PI*2, false);
				ctx1.lineWidth = 3;
				ctx1.stroke();
				ctx1.closePath();
				//箭头指针
				ctx1.beginPath();
				ctx1.moveTo(canvasWidth/2,canvasWidth*(3/10));
				ctx1.lineTo(canvasWidth/2-9,canvasWidth/2);
				ctx1.lineTo(canvasWidth/2+9,canvasWidth/2);
				ctx1.lineTo(canvasWidth/2,canvasWidth*(3/10));
				ctx1.fillStyle = color[4];
				ctx1.fill();
				ctx1.closePath();
				//中间小圆
				ctx1.beginPath();
				ctx1.arc(canvasWidth/2,canvasWidth/2,canvasWidth/10-3,0,Math.PI*2,false);
				ctx1.fillStyle = color[4];
				ctx1.fill();
				ctx1.closePath();
				//小圆文字
				ctx1.font = "Bold 16px Microsoft YaHei"; 
				ctx1.textAlign='start';
				ctx1.textBaseline='middle';
				ctx1.fillStyle = color[3];
				ctx1.beginPath();
				ctx1.fillText('开始',canvasWidth/2-16,canvasWidth/2-1,40);
				ctx1.fill();
				ctx1.closePath();
			}
		}
	
		//转盘旋转
		function runCup(){
			var degValue = 'rotate('+angles+'deg'+')';
			$('#myCanvas').css('-o-transform',degValue);           //Opera
			$('#myCanvas').css('-ms-transform',degValue);          //IE浏览器
			$('#myCanvas').css('-moz-transform',degValue);         //Firefox
			$('#myCanvas').css('-webkit-transform',degValue);      //Chrome和Safari
			$('#myCanvas').css('transform',degValue);
		}		
		
		//获取随机数
		function rnd(n, m){
			return Math.floor(Math.random()*(m-n+1)+n)
		}
		
		//判断 str 是否存在于 arrtay 中
		function ifRepeat(array,str){
			for(var i=0;i<array.length;i++){
				if(array[i]==str){
					return true;
				}
			}
			return false;
		}
	});
	</script>
</body>
</html>