<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<title>转盘抽奖</title>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<style>
* { padding: 0px; margin: 0px; font-size: 16px; font-family: "Microsoft YaHei"; }
.turnplate_box { width: 300px; height: 300px; margin: 100px auto; position: relative; }
.turnplate_box canvas { position: absolute; }
#myCanvas { background-color: white; border-radius: 100%; }
#myCanvas01 { left: 0; top: 0; z-index: 30; }
#myCanvas { -o-transform: transform 6s; -ms-transform: transform 6s; -moz-transform: transform 6s; -webkit-transform: transform 6s; transition: transform 6s; -o-transform-origin: 50% 50%; -ms-transform-origin: 50% 50%; -moz-transform-origin: 50% 50%; -webkit-transform-origin: 50% 50%; transform-origin: 50% 50%; }
.turnplatw_btn { width: 60px; height: 60px; left: 120px; top: 120px; border-radius: 100%; position: absolute; cursor: pointer; border: none; background: transparent; outline: none; z-index: 40; }
</style>
<script type="text/javascript" src="js/jquery.min.js"></script>
</head>
<body>
<div class="turnplate_box">
    <canvas id="myCanvas" width="300px" height="300px">抱歉！浏览器不支持。</canvas>
    <canvas id="myCanvas01" width="300px" height="300px">抱歉！浏览器不支持。</canvas>
    <button id="tupBtn" class="turnplatw_btn"></button>
</div>
    <script type="text/javascript">
	//转盘刻画参考 http://www.17sucai.com/pins/14555.html
	CanvasRenderingContext2D.prototype.fillTextVertical = function (text, x, y) {
		var context = this;
		var canvas = context.canvas;
		
		var arrText = text.split('');
		var arrWidth = arrText.map(function (letter) {
			return context.measureText(letter).width;
		});
		
		var align = context.textAlign;
		var baseline = context.textBaseline;
		
		if (align == 'left') {
			x = x + Math.max.apply(null, arrWidth) / 2;
		} else if (align == 'right') {
			x = x - Math.max.apply(null, arrWidth) / 2;
		}
		if (baseline == 'bottom' || baseline == 'alphabetic' || baseline == 'ideographic') {
			y = y - arrWidth[0] / 2;
		} else if (baseline == 'top' || baseline == 'hanging') {
			y = y + arrWidth[0] / 2;
		}
		
		context.textAlign = 'center';
		context.textBaseline = 'middle';
		
		// 开始逐字绘制
		arrText.forEach(function (letter, index) {
			// 确定下一个字符的纵坐标位置
			var letterWidth = arrWidth[index];
			// 是否需要旋转判断
			var code = letter.charCodeAt(0);
			if (code <= 256) {
				context.translate(x, y);
				// 英文字符，旋转90°
				context.rotate(90 * Math.PI / 180);
				context.translate(-x, -y);
			} else if (index > 0 && text.charCodeAt(index - 1) < 256) {
				// y修正
				y = y + arrWidth[index - 1] / 2;
			}
			context.fillText(letter, x, y);
			// 旋转坐标系还原成初始态
			context.setTransform(1, 0, 0, 1, 0, 0);
			// 确定下一个字符的纵坐标位置
			var letterWidth = arrWidth[index];
			y = y + letterWidth;
		});
		// 水平垂直对齐方式还原
		context.textAlign = align;
		context.textBaseline = baseline;
	};
	$(document).ready(function(){
		//旋转角度
		var angles;
		//可抽奖次数
		var clickNum = 5;
		//旋转次数
		var rotNum = 0;
		//中奖公告
		var notice = null;
		//转盘初始化
		var color = ["#e9536a","#fbd7a1","#000","#000","#fff","#444"];
		var info = ["片区一","片区二","片区三","片区四","片区五","片区六","片区七","片区八"];
		canvasRun();
		$('#tupBtn').bind('click',function(){
			if (clickNum >= 1) {
				//可抽奖次数减一
				clickNum = clickNum-1;
				//转盘旋转
				runCup();
				//转盘旋转过程“开始抽奖”按钮无法点击
				$('#tupBtn').attr("disabled", true);
				//旋转次数加一
				rotNum = rotNum + 1;
				//“开始抽奖”按钮无法点击恢复点击
				setTimeout(function(){
					alert(notice);
					$('#tupBtn').removeAttr("disabled", true);
				},6000);
			}
			else{
				alert("亲，抽奖次数已用光！");
			}
		});
	
		//转盘旋转
		function runCup(){
			probability();
			var degValue = 'rotate('+angles+'deg'+')';
			$('#myCanvas').css('-o-transform',degValue);           //Opera
			$('#myCanvas').css('-ms-transform',degValue);          //IE浏览器
			$('#myCanvas').css('-moz-transform',degValue);         //Firefox
			$('#myCanvas').css('-webkit-transform',degValue);      //Chrome和Safari
			$('#myCanvas').css('transform',degValue);
		}
	
		//各奖项对应的旋转角度及中奖公告内容
		function probability(){
			//获取随机数
			var num = parseInt(Math.random()*(7 - 0 + 0) + 0);
			//概率
			if ( num == 0 ) {
				angles = 2160 * rotNum + 1800;
				notice = info[0];
			}
			//概率
			else if ( num == 1 ) {
				angles = 2160 * rotNum + 1845;
				notice = info[7];
			}
			//概率
			else if ( num == 2 ) {
				angles = 2160 * rotNum + 1890;
				notice = info[6];
			}
			//概率
			else if ( num == 3 ) {
				angles = 2160 * rotNum + 1935;
				notice = info[5];
			}
			//概率
			else if ( num == 4 ) {
				angles = 2160 * rotNum + 1980;
				notice = info[4];
			}
			//概率
			else if ( num == 5 ) {
				angles = 2160 * rotNum + 2025;
				notice = info[3];
			}
			//概率
			else if ( num == 6 ) {
				angles = 2160 * rotNum + 2070;
				notice = info[2];
			}
			//概率
			else if ( num == 7 ) {
				angles = 2160 * rotNum + 2115;
				notice = info[1];
			}
		}
	
		//绘制转盘
		function canvasRun(){
			var canvas=document.getElementById('myCanvas');
			var canvas01=document.getElementById('myCanvas01');
			var ctx=canvas.getContext('2d');
			var ctx1=canvas01.getContext('2d');
			initSector();
			initSectorText();
			initPoint();
		
			//初始化扇形转盘
			function initSector(){
				var startAngle = 0;//扇形的开始弧度
				var endAngle = 0;//扇形的终止弧度
								
				//画一个8等份扇形组成的圆形
				for (var i = 0; i< 8; i++){
					startAngle = Math.PI*(i/4-1/8);
					endAngle = startAngle+Math.PI*(1/4);
					ctx.save();
					ctx.beginPath(); 
					ctx.arc(150,150,150, startAngle, endAngle, false);
					ctx.lineWidth = 300;
					if (i%2 == 0) {
						ctx.strokeStyle =  color[0];
					}else{
						ctx.strokeStyle =  color[1];
					}
					ctx.stroke();
					ctx.restore();
				} 
				
				//中间白底圆圈：半径：30
				ctx.beginPath();
				ctx.arc(150,150,30,0,Math.PI*2,false);
				ctx.fillStyle = color[4];
				ctx.fill();
				ctx.closePath();
			}
	
			//初始化扇形转盘文字
			function initSectorText(){	 
				ctx.textAlign='start';
				ctx.textBaseline='middle';
				ctx.fillStyle = color[3];
				var step = 2*Math.PI/8;
				for ( var i = 0; i < 8; i++) {
					ctx.save();
					ctx.beginPath();
					ctx.translate(150,150);
					ctx.rotate(i*step);
					ctx.font = "Bold 16px Microsoft YaHei";
					ctx.fillStyle = color[3];
					ctx.fillText(info[i],-20,-115,40);
					//ctx.fillTextVertical(info[i],20,115);
					ctx.closePath();
					ctx.restore();
				}
			}
	
			function initPoint(){ 
				//画转盘最外边边框
				ctx1.beginPath(); 
				ctx1.strokeStyle = color[5];
				ctx1.arc(150,150,148, 0, Math.PI*2, false);
				ctx1.lineWidth = 3;
				ctx1.stroke();
				ctx1.closePath();
				//箭头指针
				ctx1.beginPath();
				ctx1.moveTo(150,90);
				ctx1.lineTo(142,130);
				ctx1.lineTo(158,130);
				ctx1.lineTo(150,90);
				ctx1.fillStyle = color[5];
				ctx1.fill();
				ctx1.closePath();
				//中间小圆
				ctx1.beginPath();
				ctx1.arc(150,150,27,0,Math.PI*2,false);
				ctx1.fillStyle = color[5];
				ctx1.fill();
				ctx1.closePath();
				//小圆文字
				ctx1.font = "Bold 16px Microsoft YaHei"; 
				ctx1.textAlign='start';
				ctx1.textBaseline='middle';
				ctx1.fillStyle = color[4];
				ctx1.beginPath();
				ctx1.fillText('开始',134,149,40);
				ctx1.fill();
				ctx1.closePath();
			}
		}
	});
	</script>
</body>
</html>